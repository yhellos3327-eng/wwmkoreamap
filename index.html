<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연운 - 한국어 지도 맵</title>
    <link rel="icon" type="image/png" href="https://cdn.discordapp.com/emojis/1410879101194993744.webp?size=256" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/main-notice.css">
    <script src="js/mobile-console.js"></script>
</head>

<body>
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">연운 한국 맵스</div>
            <div class="loading-bar-container">
                <div id="loading-bar" class="loading-bar"></div>
            </div>
            <div id="loading-text" class="loading-text">Initializing...</div>
            <div id="loading-detail" class="loading-detail"></div>
        </div>
    </div>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>연운 한국어 맵</h1>
                <div style="display:flex; gap:5px;">
                    <button id="open-github-modal" class="close-btn" title="기여하기">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg"
                            alt="GitHub" style="width: 20px;height: 20px;filter: invert(100%);">
                    </button>
                    <a href="notice.html" class="close-btn" title="공지사항"
                        style="text-decoration: none; display: flex; align-items: center; justify-content: center;">📢</a>
                    <button id="open-settings" class="close-btn" title="설정">⚙️</button>
                    <button id="toggle-sidebar" class="close-btn">&times;</button>
                </div>
            </div>
            <div class="ad-container">
                <div class="ad-placeholder">
                    <span>광고 영역 (미구현)</span>
                </div>
                <h3>설정에서 끄실수 있습니다. 심사 설정 때문에 임시로 광고 설정을 ON으로 조정하였습니다. 🙇‍♂️</h3>
            </div>

            <div class="search-container">
                <input type="text" id="search-input" placeholder="이름, 지역, 카테고리 검색...">
                <div id="search-results" class="search-results hidden"></div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="category-tab">카테고리</button>
                <button class="tab-btn" data-tab="region-tab">지역</button>
                <button class="tab-btn" data-tab="favorite-tab">즐겨찾기</button>
            </div>

            <div class="filter-container">
                <div id="category-tab" class="tab-content active">
                    <div class="translation-progress-container">
                        <div class="progress-header">
                            <span class="progress-title">한글화 진행도</span>
                            <span class="progress-percent" id="trans-percent">0%</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" id="trans-bar" style="width: 0%"></div>
                        </div>
                        <div class="progress-stats" id="trans-stats">
                            0 / 0 항목 번역됨
                        </div>
                    </div>
                    <button id="btn-toggle-cat" class="btn-toggle-all">👁️ 모두 끄기</button>
                    <div id="category-list" class="category-list"></div>
                </div>

                <div id="region-tab" class="tab-content">
                    <button id="btn-toggle-reg" class="btn-toggle-all">👁️ 모두 끄기</button>
                    <div id="region-list" class="category-list region-grid">
                    </div>
                </div>

                <div id="favorite-tab" class="tab-content">
                    <div id="favorite-list" class="favorite-list">
                        <p class="empty-msg">즐겨찾기한 항목이 없습니다.</p>
                    </div>
                </div>
            </div>
        </aside>

        <main id="map-container">
            <div class="top-controls">
                <div class="map-toolbar">
                    <button id="open-sidebar" class="toolbar-btn menu-trigger">
                        <span class="icon">☰</span>
                        <span class="label">메뉴</span>
                    </button>

                    <div class="toolbar-divider"></div>

                    <div class="map-selector-wrapper">
                        <div class="custom-select" id="custom-map-select">
                            <div class="select-trigger">
                                <span class="icon">🌍</span>
                                <span class="selected-text">청하</span>
                                <span class="arrow">▼</span>
                            </div>
                            <div class="select-options">
                            </div>
                        </div>
                    </div>
                    <div class="toolbar-divider embed-only"></div>
                    <a id="btn-open-original" class="toolbar-btn embed-only" href="#" title="새 탭에서 원본 지도 열기">
                        <span class="icon">↗️</span>
                    </a>
                </div>
            </div>

            <div id="map"></div>
        </main>

    </div>

    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>설정</h3>
                <button id="close-settings" class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body settings-modal-body">
                <div class="settings-group">


                    <label class="settings-label" style="margin-top: 15px;">AI Service Provider <span
                            class="settings-subtitle">(AI 서비스 선택)</span></label>
                    <select id="api-provider-select" class="settings-input"
                        style="background-color: var(--bg-dark); color: var(--text-main); margin-bottom: 15px;">
                        <option value="gemini">Google Gemini</option>
                        <option value="openai">OpenAI (ChatGPT)</option>
                        <option value="claude">Anthropic (Claude)</option>
                    </select>
                    <label class="settings-label">API Key <span class="settings-subtitle">(선택한 서비스의
                            키)</span></label>
                    <input type="password" id="api-key-input" class="settings-input" placeholder="API Key 입력">
                </div>

                <div class="settings-group">
                    <label class="settings-label">AI Model <span class="settings-subtitle">(모델 선택)</span></label>

                    <select id="api-model-select" class="settings-input"
                        style="background-color: var(--bg-dark); color: var(--text-main);">



                    </select>
                </div>


                <div class="settings-group settings-toggle-wrapper">
                    <div class="settings-label-container">
                        <span class="settings-toggle-label">광고 표시</span>
                        <span class="settings-subtitle">(화면 설정)</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="toggle-ad" checked>
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="settings-group settings-toggle-wrapper">
                    <div class="settings-label-container">
                        <span class="settings-toggle-label">완료된 항목 숨기기</span>
                        <span class="settings-subtitle">(필터링 옵션)</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="toggle-hide-completed">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="settings-group settings-toggle-wrapper">
                    <div class="settings-label-container">
                        <span class="settings-toggle-label">마커 클러스터링</span>
                        <span class="settings-subtitle">(최적화 옵션)</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="toggle-cluster">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="settings-group settings-toggle-wrapper">
                    <div class="settings-label-container">
                        <span class="settings-toggle-label">이정표 표시</span>
                        <span class="settings-subtitle">(팝업 옵션)</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="toggle-comments" checked>
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="settings-group settings-toggle-wrapper">
                    <div class="settings-label-container">
                        <span class="settings-toggle-label">완료 체크 시 팝업 닫기</span>
                        <span class="settings-subtitle">(팝업 옵션)</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="toggle-close-on-complete">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="settings-group">
                    <label class="settings-label">지역 경계선 색상 <span class="settings-subtitle">(지도 스타일)</span></label>
                    <div class="color-picker-wrapper">
                        <div class="color-input-container">
                            <input type="color" id="region-line-color" value="#242424" class="color-input">
                            <span class="color-value" id="region-line-color-value">#242424</span>
                        </div>
                        <span class="color-label">기본값: #242424</span>
                    </div>
                </div>

                <div class="settings-group">
                    <label class="settings-label">지역 채우기 색상 <span class="settings-subtitle">(지도 스타일)</span></label>
                    <div class="color-picker-wrapper">
                        <div class="color-input-container">
                            <input type="color" id="region-fill-color" value="#ffbd53" class="color-input">
                            <span class="color-value" id="region-fill-color-value">#ffbd53</span>
                        </div>
                        <span class="color-label">기본값: #ffbd53</span>
                    </div>
                </div>
                <div class="settings-backup-section">
                    <h4>💾 데이터 백업 및 복구</h4>
                    <p>
                        현재까지의 진행 상황을 파일로 저장하거나 불러옵니다.<br>
                        <span style="color: #d9534f; font-size: 0.8em;">
                            <li style="margin-left: 20px;margin-bottom: 10px;">불러오기 시 현재 데이터는 덮어씌워집니다.</li>
                        </span>
                    </p>

                    <div class="backup-buttons" style="display: flex; gap: 10px;">
                        <button id="btn-backup-save" class="modal-btn save-btn"
                            style="flex: 1; padding: 8px; cursor: pointer;">
                            파일로 저장
                        </button>

                        <button id="btn-backup-load" class="modal-btn load-btn"
                            style="flex: 1; padding: 8px; cursor: pointer;">
                            파일 불러오기
                        </button>

                        <input type="file" id="inp-backup-file" accept=".json" style="display: none;">
                    </div>
                </div>
                <button id="save-api-key" class="action-btn"
                    style="width:100%; background:var(--accent); color:black; font-weight:bold;">저장</button>
                <ul class="settings-note">
                    <li>API Key는 브라우저(Local Storage)에만 저장되며 서버로 전송되지 않습니다.</li>
                    <li>미번역 항목에 대해 수동으로 번역 버튼을 눌렀을 때만 사용됩니다.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="github-modal" class="modal-overlay hidden">
        <div class="modal-content github-modal-content">
            <div class="modal-header">
                <h3 id="github-modal-title">기여하기</h3>
                <button class="close-modal-btn"
                    onclick="document.getElementById('github-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <div class="github-intro">
                    <p id="github-modal-desc">
                        이 지도는 커뮤니티의 기여로 만들어집니다.<br>
                        잘못된 정보가 있거나 새로운 정보를 추가하고 싶다면 언제든 알려주세요.
                    </p>
                </div>

                <div id="github-modal-links" class="github-links-grid">
                </div>

                <div id="contribution-guide-container" class="contribution-guide">
                </div>
            </div>
        </div>
    </div>

    <div id="related-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">관련 항목</h3>
                <button class="close-modal-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-search">
                <input type="text" id="modal-search-input" placeholder="리스트 내 검색...">
            </div>
            <div class="modal-body">
                <ul id="modal-list" class="modal-list-items">
                </ul>
            </div>
        </div>
    </div>

    <div id="dev-modal" class="modal-overlay hidden" style="z-index: 9999;">
        <div class="modal-content">
            <div class="modal-header" style="border-bottom: 1px solid var(--accent);">
                <h3 style="color: var(--accent);">🛠️ 데이터 추가 도구</h3>
                <button class="close-modal-btn"
                    onclick="document.getElementById('dev-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <form id="dev-form" style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1;">
                            <label style="font-size: 0.8rem; color: #888;">X 좌표</label>
                            <input type="text" id="dev-x" readonly
                                style="width: 100%; background: #222; border: 1px solid #444; color: #aaa;">
                        </div>
                        <div style="flex:1;">
                            <label style="font-size: 0.8rem; color: #888;">Y 좌표</label>
                            <input type="text" id="dev-y" readonly
                                style="width: 100%; background: #222; border: 1px solid #444; color: #aaa;">
                        </div>
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">카테고리</label>
                        <select id="dev-category"
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px;">
                        </select>
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">이름 (English Key)</label>
                        <input type="text" id="dev-name" placeholder="예: Chest, NPC Name..."
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px;">
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">설명 (선택)</label>
                        <textarea id="dev-desc" rows="3" placeholder="HTML 태그 사용 가능"
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; resize: vertical;"></textarea>
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">이미지 (드래그 & 드롭 또는 붙여넣기)</label>
                        <div id="dev-drop-zone"
                            style="border: 2px dashed #555; padding: 20px; text-align: center; color: #888; border-radius: 4px; cursor: pointer; transition: all 0.2s;">
                            <p style="margin: 0; pointer-events: none;">이미지를 이곳에 드래그하거나 클릭하여 선택하세요.<br>(Ctrl+V로 붙여넣기 가능)
                            </p>
                            <input type="file" id="dev-image-input" accept="image/*" multiple style="display: none;">
                        </div>
                        <div id="dev-image-preview"
                            style="display: flex; gap: 10px; overflow-x: auto; margin-top: 10px; padding-bottom: 5px;">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="lightbox-modal" class="modal-overlay hidden" onclick="closeLightbox()">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <button class="lightbox-nav prev" onclick="event.stopPropagation(); switchLightbox(-1)">❮</button>
        <button class="lightbox-nav next" onclick="event.stopPropagation(); switchLightbox(1)">❯</button>
        <div id="lightbox-media-container" class="lightbox-content" onclick="event.stopPropagation()"
            style="display: flex; justify-content: center; align-items: center; width: 100%; height: 100%;"></div>
    </div>

    <div id="video-lightbox-modal" class="modal-overlay hidden" onclick="closeVideoLightbox()">
        <span class="lightbox-close" onclick="closeVideoLightbox()">&times;</span>
        <div class="video-lightbox-content" onclick="event.stopPropagation()">
            <div class="settings-label-container">
                <span class="settings-toggle-label">마커 클러스터링</span>
                <span class="settings-subtitle">(최적화 옵션)</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-cluster">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="settings-group settings-toggle-wrapper">
            <div class="settings-label-container">
                <span class="settings-toggle-label">이정표 표시</span>
                <span class="settings-subtitle">(팝업 옵션)</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-comments" checked>
                <span class="slider round"></span>
            </label>
        </div>

        <div class="settings-group settings-toggle-wrapper">
            <div class="settings-label-container">
                <span class="settings-toggle-label">완료 체크 시 팝업 닫기</span>
                <span class="settings-subtitle">(팝업 옵션)</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-close-on-complete">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="settings-group">
            <label class="settings-label">지역 경계선 색상 <span class="settings-subtitle">(지도 스타일)</span></label>
            <div class="color-picker-wrapper">
                <div class="color-input-container">
                    <input type="color" id="region-line-color" value="#242424" class="color-input">
                    <span class="color-value" id="region-line-color-value">#242424</span>
                </div>
                <span class="color-label">기본값: #242424</span>
            </div>
        </div>

        <div class="settings-group">
            <label class="settings-label">지역 채우기 색상 <span class="settings-subtitle">(지도 스타일)</span></label>
            <div class="color-picker-wrapper">
                <div class="color-input-container">
                    <input type="color" id="region-fill-color" value="#ffbd53" class="color-input">
                    <span class="color-value" id="region-fill-color-value">#ffbd53</span>
                </div>
                <span class="color-label">기본값: #ffbd53</span>
            </div>
        </div>
        <div class="settings-backup-section">
            <h4>💾 데이터 백업 및 복구</h4>
            <p>
                현재까지의 진행 상황을 파일로 저장하거나 불러옵니다.<br>
                <span style="color: #d9534f; font-size: 0.8em;">
                    <li style="margin-left: 20px;margin-bottom: 10px;">불러오기 시 현재 데이터는 덮어씌워집니다.</li>
                </span>
            </p>

            <div class="backup-buttons" style="display: flex; gap: 10px;">
                <button id="btn-backup-save" class="modal-btn save-btn" style="flex: 1; padding: 8px; cursor: pointer;">
                    파일로 저장
                </button>

                <button id="btn-backup-load" class="modal-btn load-btn" style="flex: 1; padding: 8px; cursor: pointer;">
                    파일 불러오기
                </button>

                <input type="file" id="inp-backup-file" accept=".json" style="display: none;">
            </div>
        </div>
        <button id="save-api-key" class="action-btn"
            style="width:100%; background:var(--accent); color:black; font-weight:bold;">저장</button>
        <ul class="settings-note">
            <li>API Key는 브라우저(Local Storage)에만 저장되며 서버로 전송되지 않습니다.</li>
            <li>미번역 항목에 대해 수동으로 번역 버튼을 눌렀을 때만 사용됩니다.</li>
        </ul>
    </div>
    </div>
    </div>

    <div id="github-modal" class="modal-overlay hidden">
        <div class="modal-content github-modal-content">
            <div class="modal-header">
                <h3 id="github-modal-title">기여하기</h3>
                <button class="close-modal-btn"
                    onclick="document.getElementById('github-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <div class="github-intro">
                    <p id="github-modal-desc">
                        이 지도는 커뮤니티의 기여로 만들어집니다.<br>
                        잘못된 정보가 있거나 새로운 정보를 추가하고 싶다면 언제든 알려주세요.
                    </p>
                </div>

                <div id="github-modal-links" class="github-links-grid">
                </div>

                <div id="contribution-guide-container" class="contribution-guide">
                </div>
            </div>
        </div>
    </div>

    <div id="related-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">관련 항목</h3>
                <button class="close-modal-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-search">
                <input type="text" id="modal-search-input" placeholder="리스트 내 검색...">
            </div>
            <div class="modal-body">
                <ul id="modal-list" class="modal-list-items">
                </ul>
            </div>
        </div>
    </div>

    <div id="dev-modal" class="modal-overlay hidden" style="z-index: 9999;">
        <div class="modal-content">
            <div class="modal-header" style="border-bottom: 1px solid var(--accent);">
                <h3 style="color: var(--accent);">🛠️ 데이터 추가 도구</h3>
                <button class="close-modal-btn"
                    onclick="document.getElementById('dev-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <form id="dev-form" style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; gap: 10px;">
                        <div style="flex:1;">
                            <label style="font-size: 0.8rem; color: #888;">X 좌표</label>
                            <input type="text" id="dev-x" readonly
                                style="width: 100%; background: #222; border: 1px solid #444; color: #aaa;">
                        </div>
                        <div style="flex:1;">
                            <label style="font-size: 0.8rem; color: #888;">Y 좌표</label>
                            <input type="text" id="dev-y" readonly
                                style="width: 100%; background: #222; border: 1px solid #444; color: #aaa;">
                        </div>
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">카테고리</label>
                        <select id="dev-category"
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px;">
                        </select>
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">이름 (English Key)</label>
                        <input type="text" id="dev-name" placeholder="예: Chest, NPC Name..."
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px;">
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">설명 (선택)</label>
                        <textarea id="dev-desc" rows="3" placeholder="HTML 태그 사용 가능"
                            style="width: 100%; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; resize: vertical;"></textarea>
                    </div>

                    <div>
                        <label style="font-size: 0.8rem; color: #ccc;">이미지 (드래그 & 드롭 또는 붙여넣기)</label>
                        <div id="dev-drop-zone"
                            style="border: 2px dashed #555; padding: 20px; text-align: center; color: #888; border-radius: 4px; cursor: pointer; transition: all 0.2s;">
                            <p style="margin: 0; pointer-events: none;">이미지를 이곳에 드래그하거나 클릭하여 선택하세요.<br>(Ctrl+V로 붙여넣기 가능)
                            </p>
                            <input type="file" id="dev-image-input" accept="image/*" multiple style="display: none;">
                        </div>
                        <div id="dev-image-preview"
                            style="display: flex; gap: 10px; overflow-x: auto; margin-top: 10px; padding-bottom: 5px;">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="lightbox-modal" class="modal-overlay hidden" onclick="closeLightbox()">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <button class="lightbox-nav prev" onclick="event.stopPropagation(); switchLightbox(-1)">❮</button>
        <button class="lightbox-nav next" onclick="event.stopPropagation(); switchLightbox(1)">❯</button>
        <div id="lightbox-media-container" class="lightbox-content" onclick="event.stopPropagation()"
            style="display: flex; justify-content: center; align-items: center; width: 100%; height: 100%;"></div>
    </div>

    <div id="video-lightbox-modal" class="modal-overlay hidden" onclick="closeVideoLightbox()">
        <span class="lightbox-close" onclick="closeVideoLightbox()">&times;</span>
        <div class="video-lightbox-content" onclick="event.stopPropagation()">
            <iframe id="lightbox-video-frame" frameborder="0" allowfullscreen allow="autoplay"></iframe>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="js/ads.js"></script>
    <script type="module" src="js/main.js"></script>
</body>

</html>